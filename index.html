<style type="text/css">
    body {
        background: black;
        color: white;
        font: 15px/1.5 monospace;
        cursor: crosshair;
    }
    #pointer {
        background: green;
        position: absolute;
        top: 0;
        left: 0;
        padding: 0.1em 0.5em;
    }
</style>

<div id="pointer"></div>
<audio id="pow" src="pow1.wav"></audio>
<audio autoplay src="load.wav"></audio>

<script src="http://code.jquery.com/jquery-1.11.0.min.js"></script>
<script src="http://cdnjs.cloudflare.com/ajax/libs/underscore.js/1.6.0/underscore-min.js"></script>
<script src="http://localhost:9582/socket.io/socket.io.js"></script>
<script type="text/javascript">
    function map(value, fromLow, fromHigh, toLow, toHigh) {
        return (value - fromLow) * (toHigh - toLow) / (fromHigh - fromLow) + toLow
      }
    var socket = io("http://localhost:9582");
    var $pointer = $(window.pointer);

    function goToEvent(event) {
        var pX = parseInt(event.pageX, 10);
        var pY = parseInt(event.pageY, 10);
        var x = ~~map(pX, 0, window.innerWidth, 175, 0);
        var y = ~~map(pY, 0, window.innerHeight, 110, 175);
        socket.emit("xy", {
            x: x,
            y: y
        });
    }
    function pointerToEvent(event) {
        var pX = parseInt(event.pageX, 10);
        var pY = parseInt(event.pageY, 10);
        var x = ~~map(pX, 0, window.innerWidth, 175, 0);
        var y = ~~map(pY, 0, window.innerHeight, 90, 160);
        $pointer.css({
            left: pX,
            top: pY
        }).text(x + ',' + y);
    }

    function fire() {
        window.pow.play();
        socket.emit('on');
        setTimeout(function () {
            socket.emit('off');
        }, 300);
    }
    var debouncedFire = _.throttle(fire, 1000, true);

    var down = false;
    var keydown = false;
    $(document).on('mousedown', function () {
        down = true;
    });
    $(document).on('mouseup', function () {
        down = false;
    });
    $(document).on('mousemove', function (event) {
        pointerToEvent(event);
        if (!down) return;
        goToEvent(event);
    });
    $(document).on('click', function (event) {
        goToEvent(event);
    });
    $(document).on('keydown', function (event) {
        if (event.which == 32 && !keydown) {
            keydown = true;
            debouncedFire();
        }
    });
    $(document).on('keyup', function (event) {
        if (event.which == 32) {
            keydown = false;
        }
    });
</script>
